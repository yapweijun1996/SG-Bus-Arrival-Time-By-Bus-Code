<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bus Arrival Information</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="header-content">
      <h1>Bus Arrival Information</h1>
      <p>Enter a bus stop ID below to see the upcoming bus arrivals. If left empty, it defaults to 70049.</p>
    </div>
  </header>
  <section class="search-section">
    <div class="form-container">
      <form id="idForm">
        <label for="busId">Bus Stop ID</label>
        <input type="text" id="busId" name="busId" placeholder="70049">
        <button type="submit">Check Arrival</button>
      </form>
    </div>
  </section>
  <section id="content">
    <div id="loading" class="hidden">Loading upcoming bus arrivals...</div>
    <div id="error" class="hidden"></div>
    <div id="services"></div>
  </section>
  <script src="script.js"></script>
</body>
</html>
<style>
/* Reset and Base Styles */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Roboto', sans-serif;
  background: #eff3f6;
  color: #444;
  line-height: 1.6;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-bottom: 50px;
}

/* Header Styling */
header {
  width: 100%;
  background: linear-gradient(135deg, #4CAF50, #66BB6A);
  color: #fff;
  padding: 30px 15px;
  text-align: center;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.header-content h1 {
  font-size: 2rem;
  margin-bottom: 10px;
}

.header-content p {
  font-size: 1rem;
  opacity: 0.95;
}

/* Search Section Styling */
.search-section {
  width: 100%;
  display: flex;
  justify-content: center;
  margin: 30px 0;
}

.form-container {
  background: #fff;
  padding: 25px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  width: 90%;
  max-width: 500px;
}

.search-section form {
  display: flex;
  flex-direction: column;
}

.search-section label {
  font-weight: 500;
  margin-bottom: 10px;
  color: #333;
}

.search-section input {
  padding: 14px 18px;
  font-size: 1rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  margin-bottom: 20px;
  outline: none;
  transition: border 0.3s ease;
}

.search-section input:focus {
  border-color: #4CAF50;
}

.search-section button {
  padding: 14px 18px;
  background-color: #4CAF50;
  color: #fff;
  font-size: 1rem;
  font-weight: 500;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.3s ease, transform 0.2s ease;
}

.search-section button:hover {
  background-color: #43A047;
  transform: translateY(-2px);
}

/* Content Section Styling */
#content {
  width: 90%;
  max-width: 700px;
  margin-bottom: 50px;
}

#loading, #error {
  text-align: center;
  font-size: 1.1rem;
  margin: 20px 0;
}

#error {
  color: #d9534f;
}

.service {
  background: #fff;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.service:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
}

.service h2 {
  margin-bottom: 15px;
  font-size: 1.6rem;
  border-bottom: 1px solid #eee;
  padding-bottom: 5px;
  color: #4CAF50;
}

.trip {
  margin-bottom: 15px;
}

.trip-header {
  display: flex;
  justify-content: space-between;
  background: #f9f9f9;
  padding: 10px;
  border-radius: 4px;
  font-weight: 600;
  font-size: 1rem;
  color: #333;
}

.trip-details {
  padding: 8px 10px;
  font-size: 0.95rem;
  color: #555;
  border-left: 3px solid #4CAF50;
  margin-top: 5px;
}

.hidden {
  display: none;
}

/* Mobile Responsive Adjustments */
@media (max-width: 600px) {
  header {
    padding: 20px 10px;
  }

  .header-content h1 {
    font-size: 1.8rem;
  }

  .form-container {
    padding: 20px;
  }

  .search-section input, .search-section button {
    font-size: 0.95rem;
    padding: 12px 15px;
  }

  .service {
    padding: 15px;
  }

  .trip-header {
    font-size: 0.95rem;
  }

  .trip-details {
    font-size: 0.9rem;
  }
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const DEFAULT_ID = '70049';
  const urlParams = new URLSearchParams(window.location.search);
  let id = urlParams.get('id');
  const busIdInput = document.getElementById('busId');
  const idForm = document.getElementById('idForm');
  const servicesDiv = document.getElementById('services');
  const loadingDiv = document.getElementById('loading');
  const errorDiv = document.getElementById('error');

  // Set default if id not provided
  if (!id) {
    id = DEFAULT_ID;
    busIdInput.value = DEFAULT_ID;
    window.history.replaceState(null, '', `?id=${encodeURIComponent(DEFAULT_ID)}`);
  } else {
    busIdInput.value = id;
  }

  fetchAndDisplay(id);

  idForm.addEventListener('submit', function(event) {
    event.preventDefault();
    let newId = busIdInput.value.trim();
    if (!newId) {
      newId = DEFAULT_ID;
    }
    window.history.pushState(null, '', `?id=${encodeURIComponent(newId)}`);
    fetchAndDisplay(newId);
  });

  function fetchAndDisplay(id) {
    loadingDiv.classList.remove('hidden');
    errorDiv.classList.add('hidden');
    servicesDiv.innerHTML = '';

    const apiUrl = `https://arrivelah2.busrouter.sg/?id=${encodeURIComponent(id)}`;
    fetch(apiUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        loadingDiv.classList.add('hidden');
        displayServices(data);
      })
      .catch(error => {
        loadingDiv.classList.add('hidden');
        errorDiv.textContent = 'Error: ' + error.message;
        errorDiv.classList.remove('hidden');
      });
  }

  function displayServices(data) {
    if (!data.services || data.services.length === 0) {
      servicesDiv.innerHTML = '<p style="text-align:center;">No bus arrivals found at this stop.</p>';
      return;
    }

    data.services.forEach(service => {
      const serviceDiv = document.createElement('div');
      serviceDiv.className = 'service';

      // Service header: showing service number and operator in a friendly manner
      const header = document.createElement('h2');
      header.textContent = `Service ${service.no} from ${service.operator}`;
      serviceDiv.appendChild(header);

      // Define friendly names for trips
      const tripLabels = {
        next: 'First Bus Arrival',
        subsequent: 'Second Bus Arrival',
        next2: 'Third Bus Arrival',
        next3: 'Fourth Bus Arrival'
      };

      Object.keys(tripLabels).forEach(key => {
        const tripData = service[key];
        if (tripData) {
          const tripContainer = document.createElement('div');
          tripContainer.className = 'trip';

          // Format time to display hours and minutes
          const time = new Date(tripData.time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          const duration = Math.ceil(tripData.duration_ms / 60000);

          // First line: Label, Time and duration in columns
          const tripHeader = document.createElement('div');
          tripHeader.className = 'trip-header';
          tripHeader.innerHTML = `<span>${tripLabels[key]}:</span> <span>${time}</span> <span>${duration} minutes</span>`;
          tripContainer.appendChild(tripHeader);

          // Second line: details on load and monitored
          const tripDetails = document.createElement('div');
          tripDetails.className = 'trip-details';
          tripDetails.textContent = `- Load: ${tripData.load}, Monitored: ${tripData.monitored ? 'Yes' : 'No'}`;
          tripContainer.appendChild(tripDetails);

          serviceDiv.appendChild(tripContainer);
        }
      });

      servicesDiv.appendChild(serviceDiv);
    });
  }
});

</script>